
# TopologyProject: Computational Topological Analysis of PFRC Plasma Data

This repository contains code, scripts, and documentation for performing computational topological analysis on plasma diagnostic data from the Princeton Field-Reversed Configuration (PFRC) Experiment. In particular, we focus on analyzing pressure data recorded during experimental shots. Our approach uses techniques from topological data analysis (TDA) – such as delay embeddings, Vietoris–Rips complexes, and persistent homology – to extract and study the underlying “shape” of the plasma dynamics.

---

## Project Overview

The PFRC experiment at PPPL collects a wealth of diagnostic data (e.g., pressure, interferometer, X-ray, TALIF, spectrometer, etc.). This project currently focuses on pressure data, which is stored in binary `.trc` files (generated by Lecroy oscilloscopes). We use the `lecroyparser` package to parse these files and extract the waveform (amplitude) and timebase data.

For the TDA analysis, we convert the 1D pressure time series into a higher-dimensional point cloud using delay (Takens) embedding. We then compute persistent homology using the `ripser` module, and visualize the resulting persistence diagrams with `persim`.

---

## Directory Structure

```
TopologyProject/
├── Data/
│   ├── raw/                
│   │   └── pfrc/20200309/pressure/  
│   │       ├── C1--pressure--00006.trc
│   │       ├── C2--pressure--00569.trc
│   │       ├── ... (other .trc files)
│   └── processed/
│       └── pressure_analysis/
│           ├── stats/       # CSV files with descriptive statistics
│           └── plots/       # PNG plots of persistence diagrams
├── notebooks/
│   └── exploratory_analysis.ipynb   # (Optional) Jupyter Notebook for interactive analysis
├── src/
│   ├── exploratory_analysis.py        # Script for processing and visualizing individual files
│   └── tda_analysis.py                # Script for delay embedding and TDA analysis (persistent homology)
├── environment.yml                    # Conda environment file with all dependencies
├── README.md                          # This file
└── LICENSE                            # License file (e.g., MIT License)
```

---

## Getting Started

### Prerequisites

- **Conda** (Miniconda or Anaconda)  
- **Python 3.10**  
- The following packages are installed via `environment.yml`:
  - Core: `numpy`, `scipy`, `pandas`, `matplotlib`, `seaborn`, `scikit-learn`
  - Jupyter and interactive tools: `jupyterlab`, `ipython`, `jupyter`
  - Utilities: `tqdm`, `h5py`, `pytables`, `xarray`, `netCDF4`, `dask`, `numba`, `cython`
  - Topological analysis: `ripser`, `gudhi`, `persim`
  - Additional pip packages: `openpyxl`, `pyarrow`, `lxml`, and `lecroyparser`

### Setting Up Your Environment

If you already have an environment named `my_analysis_env` and wish to update it with our latest `environment.yml`:

```bash
conda env update --name my_analysis_env --file environment.yml --prune
conda activate my_analysis_env
```

Or, to create a new environment:

```bash
conda env create -f environment.yml
conda activate my_analysis_env
```

---

## Data

### Raw Data

- **Location:**  
  All raw pressure data files from the PFRC experiment are located in:
  ```
  Data/raw/pfrc/20200309/pressure/
  ```
- **Format:**  
  Files are in the Lecroy `.trc` binary format and contain pressure waveforms from individual experimental shots.

### Processed Data

- **Output Directory:**  
  Analysis results (descriptive statistics and persistence diagram plots) are saved in:
  ```
  Data/processed/pressure_analysis/
  ```
  with subdirectories:
  - `stats/` – CSV files containing descriptive statistics for each .trc file.
  - `plots/` – PNG files of persistence diagrams obtained from TDA.

### Data Documentation

- A summary file (e.g., `20200309-summary.txt`) and a separate `README_data.md` in the Data directory provide additional context and metadata regarding the experiment (e.g., RF parameters, gas type, diagnostic comments).

---

## Usage

### 1. Exploratory Data Analysis

The `src/exploratory_analysis.py` script:
- Loads individual `.trc` files using the `lecroyparser` package.
- Extracts the time and pressure waveform data into a Pandas DataFrame.
- Generates simple plots and computes basic descriptive statistics.

Run the script with:
```bash
python src/exploratory_analysis.py
```

### 2. Topological Data Analysis (TDA)

The `src/tda_analysis.py` script:
- Processes each `.trc` file to extract the pressure time series.
- Performs delay embedding (Takens embedding) on the 1D pressure data to form a higher-dimensional point cloud.
- Computes persistent homology on the embedded point cloud using Ripser.
- Visualizes the persistence diagrams using Persim.
- Saves the persistence diagram plots and descriptive statistics to `Data/processed/pressure_analysis/`.

Run the TDA analysis script with:
```bash
python src/tda_analysis.py
```

### 3. Jupyter Notebook (Optional)

For an interactive analysis session, you can open the Jupyter Notebook provided in `notebooks/exploratory_analysis.ipynb`:
```bash
jupyter notebook notebooks/exploratory_analysis.ipynb
```

---

## Analysis Strategy

- **Delay Embedding:**  
  The delay embedding transforms the 1D pressure signal into a multi-dimensional point cloud. This technique is useful for capturing the dynamics of the plasma, allowing us to explore its intrinsic geometric structure.
  
- **Persistent Homology:**  
  By constructing a Vietoris–Rips complex from the embedded data and computing persistent homology, we extract robust topological features (e.g., connected components and cycles) that persist across scales. These features may correspond to significant plasma phenomena, such as pressure fluctuations related to instabilities.
  
- **Visualization & Statistics:**  
  The analysis script generates persistence diagrams for each file and computes basic statistics both for the raw pressure data and the embedded point clouds. These outputs help in identifying trends and potential correlations with plasma behavior.

---

## Contributing

Contributions to improve the code, extend the analysis, or enhance the documentation are welcome. Please open an issue or submit a pull request with your suggestions.

---

## License

This project is licensed under the [MIT License](LICENSE).

---

## Contact

For questions, feedback, or collaboration, please contact me at jrfloren@ncsu.edu.
